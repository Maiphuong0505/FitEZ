<div class="container mt-3 mb-5">
  <h1><%= @client.first_name %> <%= @client.last_name %></h1>
  <!-- Tab Navigation -->
  <ul class="nav nav-pills nav-justified mb-3" id="clientTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="body-stats-tab" data-bs-toggle="tab" data-bs-target="#body-stats" type="button" role="tab" aria-controls="body-stats" aria-selected="true">
        Body Stats
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="workout-plans-tab" data-bs-toggle="tab" data-bs-target="#workout-plans" type="button" role="tab" aria-controls="workout-plans" aria-selected="false">
        Workout Plans
      </button>
    </li>
  </ul>
  <!-- Tab Content -->
  <div class="tab-content" id="clientTabsContent">
    <!-- Tab 1: Body Stats -->
    <div class="tab-pane fade show active" id="body-stats" role="tabpanel" aria-labelledby="body-stats-tab">
      <div class="row">
        <div class="col-12 col-md-7">
          <div class="d-flex justify-content-center mt-2">
            <%= link_to "#add-body-stat-form" do %>
              <p class="button-responsive link-button badge rounded-pill mb-0 px-3 py-2 me-2 bg-danger text-light fw-normal fs-6">Add Body Stats</p>
            <% end %>
          </div>
          <!-- Bootstrap Carousel for Charts -->
          <div id="bodyStatsCarousel" class="carousel slide my-5">
            <div class="carousel-inner">
              <div class="carousel-item active">
                <%# Chart 1: Muscle Mass & Weight %>
                <div class="chartkick-mobile chartkick-shadow rounded-4 p-2 mb-2">
                  <%= line_chart [
                    {name: "Muscle Mass (kg)", data: @client.body_stats.map.with_index { |stat, i| [stat.timestamp.strftime("%d %b %Y"), stat.muscle_mass] }},
                    {name: "Weight (kg)", data: @client.body_stats.map.with_index { |stat, i| [stat.timestamp.strftime("%d %b %Y"), stat.weight] }}
                  ],
                  height: "280px",
                  width: "100%",
                  colors: ["#43B581", "#3B82F6"],
                  curve: true,
                  points: true,
                  descrete: true,
                  empty: "No data available",
                  library: {
                    responsive: true,
                    plugins: {
                      legend: { labels: { font: { size: 15, family: "Poppins" } } },
                      tooltip: { enabled: true, bodyFont: { size: 15 } }
                    }
                  } %>
                </div>
              </div>
              <div class="carousel-item">
                <%# Chart 2: Body Fat %>
                <div class="chartkick-mobile chartkick-shadow rounded-4 p-2 mb-2">
                  <%=line_chart [
                    {name: "Body Fat (%)", data: @client.body_stats.map.with_index { |stat, i| [stat.timestamp.strftime("%d %b %Y"), stat.body_fat] }}
                  ],
                  height: "280px",
                  width: "100%",
                  colors: ["#F59E42"],
                  curve: true,
                  points: true,
                  descrete: true,
                  empty: "No data available",
                  library: {
                    scales: {
                      x: {
                        ticks: {
                          source: "data"
                        }
                      }
                    },
                    responsive: true,
                    plugins: {
                      legend: { labels: { font: { size: 15, family: "Poppins" } } },
                      tooltip: { enabled: true, bodyFont: { size: 15 } }
                    }
                  } %>
                </div>
              </div>
            </div>
            <!-- Carousel Controls: moved below charts -->
            <div class="d-flex justify-content-center gap-3 mt-3">
              <button class="btn btn-outline-danger rounded-circle px-3 py-2"
    type="button"
    data-bs-target="#bodyStatsCarousel"
    data-bs-slide="prev"
    aria-label="Previous chart">
                <i class="fa-solid fa-chevron-left"></i>
              </button>
              <button class="btn btn-outline-danger rounded-circle px-3 py-2"
    type="button"
    data-bs-target="#bodyStatsCarousel"
    data-bs-slide="next"
    aria-label="Next chart">
                <i class="fa-solid fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </div>
        <%# Div for add stats %>
        <div class="col-12 col-md-5 add-body-stats-form" id="add-body-stat-form">
          <%= render 'clients/body_stat_form', client: @client, body_stat: @body_stat %>
        </div>
      </div>
    </div>
    <!-- Tab 2: Workout Plans -->
    <div class="tab-pane fade" id="workout-plans" role="tabpanel" aria-labelledby="workout-plans-tab">
      <div class="row display_workout-plans">
        <div class="col-12 col-md-7">
          <div class="d-flex justify-content-center mt-2">
            <%= link_to "#add-plan-form" do %>
              <p class="button-responsive link-button badge rounded-pill px-3 py-2 me-2 bg-danger text-light fw-normal fs-6">Schedule Workout Plan</p>
            <% end %>
          </div>
          <div class="plan-cards" id="workout_plans">
            <% unless @workout_plans.any? %>
              <% if current_user.trainer? %>
                <p class="text-muted mt-4"><i class="fa-solid fa-face-grimace"></i> <%= @client.first_name %>'s plan awaits!</p>
              <% else %>
                <p class="text-muted mt-4"><i class="fa-solid fa-face-grimace"></i> Waiting for a plan? Ask your trainer to add one!</p>
              <% end %>
            <% else %>
              <% @workout_plans.each do |plan| %>
                <%= render 'clients/workout_plan_display', workout_plans: @workout_plans, plan: plan, workout_session: @workout_session, workout_plan: plan %>
              <% end %>
            <% end %>
          </div>
        </div>
        <%# Add workout plan form %>
        <% if current_user.trainer? %>
          <div class="col-12 col-md-5 add-workout-plan-form" id="add-plan-form">
            <%= render 'workout_plans/workout_plan_form', workout_plan: @workout_plan, client: @client %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
